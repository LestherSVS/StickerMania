<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi Cuenta | Manía Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      min-height: 100vh;
      margin: 0;
      background: #101a13;
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .cuenta-section {
      width: 100%;
      max-width: 420px;
      margin: 48px auto 0 auto;
      background: #181f1b;
      border: 2px solid #00ff88;
      border-radius: 18px;
      box-shadow: 0 4px 24px #00ff8822;
      padding: 32px 18px 24px 18px;
      color: #00ff88;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    .cuenta-title {
      font-size: 2rem;
      margin-bottom: 18px;
      letter-spacing: 2px;
      text-shadow: 0 2px 12px #00ff8844;
    }
    .cuenta-form, .login-form, .perfil-form {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 18px;
      align-items: center;
    }
    .cuenta-form input, .login-form input, .perfil-form input {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #00ff8844;
      background: #101a13;
      color: #00ff88;
      width: 90%;
      max-width: 260px;
      font-size: 1rem;
    }
    .cuenta-form button, .login-form button, .perfil-form button {
      background: #00ff88;
      color: #101a13;
      border: none;
      border-radius: 8px;
      padding: 8px 18px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }
    .cuenta-form button:hover, .login-form button:hover, .perfil-form button:hover {
      background: #b6ffda;
    }
    .perfil-foto {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      background: #101a13;
      border: 2px solid #00ff88;
      margin: 0 auto 10px auto;
      display: block;
    }
    .perfil-nombre {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 8px;
      color: #b6ffda;
    }
    .logout-btn {
      margin-top: 10px;
      background: #ff4e4e;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 18px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }
    .logout-btn:hover {
      background: #c70000;
    }
    .msg {
      color: #b6ffda;
      font-size: 1rem;
      margin-bottom: 10px;
    }
    @media (max-width: 600px) {
      .cuenta-section {
        max-width: 98vw;
        padding: 18px 2vw 14px 2vw;
      }
      .cuenta-title {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <section class="cuenta-section" id="cuenta-section">
    <h2 class="cuenta-title">👤 Mi Cuenta</h2>
    <div id="cuenta-content"></div>
  </section>

  <script>
    // Utilidades de almacenamiento local
    function getUsers() {
      return JSON.parse(localStorage.getItem('usuarios') || '[]');
    }
    function saveUsers(users) {
      localStorage.setItem('usuarios', JSON.stringify(users));
    }
    function setCurrentUser(user) {
      localStorage.setItem('usuario_actual', JSON.stringify(user));
    }
    function getCurrentUser() {
      try {
        return JSON.parse(localStorage.getItem('usuario_actual'));
      } catch { return null; }
    }
    function removeCurrentUser() {
      localStorage.removeItem('usuario_actual');
    }

    // Renderizado principal
    function renderCuenta() {
      const content = document.getElementById('cuenta-content');
      const user = getCurrentUser();
      if (user) {
        // Vista de perfil y edición
        content.innerHTML = `
          <img src="${user.foto || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.nombre || 'Usuario') + '&background=101a13&color=00ff88'}" class="perfil-foto" id="perfil-foto-preview">
          <div class="perfil-nombre">${user.nombre || ''}</div>
          <form class="perfil-form" id="perfil-form">
            <input type="text" id="perfil-nombre" placeholder="Nombre" value="${user.nombre || ''}" required>
            <input type="email" id="perfil-email" placeholder="Email" value="${user.email || ''}" required>
            <input type="file" id="perfil-foto" accept="image/*">
            <button type="submit">Actualizar perfil</button>
          </form>
          <button class="logout-btn" id="logout-btn">Cerrar sesión</button>
        `;
        document.getElementById('logout-btn').onclick = () => {
          removeCurrentUser();
          renderCuenta();
        };
        document.getElementById('perfil-form').onsubmit = function(e) {
          e.preventDefault();
          const nombre = document.getElementById('perfil-nombre').value.trim();
          const email = document.getElementById('perfil-email').value.trim();
          const fotoInput = document.getElementById('perfil-foto');
          let foto = user.foto || '';
          if (fotoInput.files && fotoInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(ev) {
              foto = ev.target.result;
              updateUser(nombre, email, foto);
            };
            reader.readAsDataURL(fotoInput.files[0]);
            return;
          }
          updateUser(nombre, email, foto);
        };
      } else {
        // Vista de login/registro
        content.innerHTML = `
          <div class="msg" id="msg"></div>
          <form class="login-form" id="login-form">
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-pass" placeholder="Contraseña" required>
            <button type="submit">Iniciar sesión</button>
          </form>
          <div style="margin:10px 0;color:#b6ffda;">¿No tienes cuenta?</div>
          <form class="cuenta-form" id="register-form">
            <input type="text" id="reg-nombre" placeholder="Nombre" required>
            <input type="email" id="reg-email" placeholder="Email" required>
            <input type="password" id="reg-pass" placeholder="Contraseña" required>
            <input type="file" id="reg-foto" accept="image/*">
            <button type="submit">Crear cuenta</button>
          </form>
        `;
        document.getElementById('login-form').onsubmit = function(e) {
          e.preventDefault();
          const email = document.getElementById('login-email').value.trim();
          const pass = document.getElementById('login-pass').value;
          const users = getUsers();
          const user = users.find(u => u.email === email && u.pass === pass);
          if (user) {
            setCurrentUser(user);
            renderCuenta();
          } else {
            document.getElementById('msg').textContent = "Email o contraseña incorrectos.";
          }
        };
        document.getElementById('register-form').onsubmit = function(e) {
          e.preventDefault();
          const nombre = document.getElementById('reg-nombre').value.trim();
          const email = document.getElementById('reg-email').value.trim();
          const pass = document.getElementById('reg-pass').value;
          const fotoInput = document.getElementById('reg-foto');
          const users = getUsers();
          if (users.find(u => u.email === email)) {
            document.getElementById('msg').textContent = "Ese email ya está registrado.";
            return;
          }
          if (fotoInput.files && fotoInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(ev) {
              const foto = ev.target.result;
              saveNewUser(nombre, email, pass, foto);
            };
            reader.readAsDataURL(fotoInput.files[0]);
          } else {
            saveNewUser(nombre, email, pass, '');
          }
        };
      }
    }

    function saveNewUser(nombre, email, pass, foto) {
      const users = getUsers();
      const user = { nombre, email, pass, foto };
      users.push(user);
      saveUsers(users);
      setCurrentUser(user);
      renderCuenta();
    }

    function updateUser(nombre, email, foto) {
      let user = getCurrentUser();
      let users = getUsers();
      users = users.map(u => u.email === user.email ? { ...u, nombre, email, foto } : u);
      saveUsers(users);
      user = { ...user, nombre, email, foto };
      setCurrentUser(user);
      renderCuenta();
    }

    renderCuenta();
  </script>
</body>
</html>